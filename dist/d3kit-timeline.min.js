!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(e,n){"function"==typeof define&&define.amd?define(["d3","d3kit","labella"],n):"object"===("undefined"==typeof exports?"undefined":t(exports))?module.exports=n(require("d3"),require("d3kit"),require("labella")):e.d3KitTimeline=n(e.d3,e.d3Kit,e.labella)}(void 0,function(t,e,n){var a={margin:{left:40,right:20,top:20,bottom:20},initialWidth:400,initialHeight:400,scale:t.time.scale(),domain:void 0,direction:"right",dotRadius:3,layerGap:60,labella:{},keyFn:void 0,timeFn:function(t){return t.time},textFn:function(t){return t.text},dotColor:"#222",labelBgColor:"#222",labelTextColor:"#fff",linkColor:"#222",labelPadding:{left:4,right:4,top:3,bottom:2},textYOffset:"0.85em"},o=["dotClick","dotMouseover","dotMousemove","dotMouseout","labelClick","labelMouseover","labelMousemove","labelMouseenter","labelMouseleave","labelMouseout"];return e.factory.createChart(a,o,function(a){function o(t){return t.w}function r(t){return t.h}function i(t){return f.scale(f.timeFn(t))}function l(){var o=a.data()||[];f.domain?f.scale.domain(f.domain):f.scale.domain(t.extent(o,f.timeFn)).nice(),f.scale.range([0,"left"===f.direction||"right"===f.direction?a.getInnerHeight():a.getInnerWidth()]),y.scale(f.scale);var r;switch(f.direction){case"right":y.orient("left"),r="translate(0,0)";break;case"left":y.orient("right"),r="translate("+a.getInnerWidth()+",0)";break;case"up":y.orient("bottom"),r="translate(0,"+a.getInnerHeight()+")";break;case"down":y.orient("top"),r="translate(0,0)"}b.get("main").attr("transform",r),b.get("main.axis").call(y),d(o);var l=e.helper.extend({},f.textStyle);Object.keys(l).forEach(function(e){l[e]=t.functor(l[e])}),l.fill=l.fill||t.functor(f.labelTextColor);var s=b.get("dummy").append("text").classed("label-text",!0),m=o.map(function(t){var e=s.call(u,l,t)[0][0].getBBox(),a=e.width+f.labelPadding.left+f.labelPadding.right,o=e.height+f.labelPadding.top+f.labelPadding.bottom,r=new n.Node(i(t),"left"===f.direction||"right"===f.direction?o:a,t);return r.w=a,r.h=o,r});return s.remove(),g.options(f.labella).nodes(m).compute(),c(g.nodes(),l),a}function d(t){var e=b.get("main.dot").selectAll("circle.dot").data(t,f.keyFn),n="left"===f.direction||"right"===f.direction?"cy":"cx";e.enter().append("circle").classed("dot",!0).on("click",function(t,e){m.dotClick(t,e)}).on("mouseover",function(t,e){m.dotMouseover(t,e)}).on("mousemove",function(t,e){m.dotMousemove(t,e)}).on("mouseout",function(t,e){m.dotMouseout(t,e)}).style("fill",f.dotColor).attr("r",f.dotRadius).attr(n,i),e.transition().style("fill",f.dotColor).attr("r",f.dotRadius).attr(n,i),e.exit().remove()}function c(e,a){function i(t){switch(f.direction){case"right":return"translate("+t.x+","+(t.y-t.dy/2)+")";case"left":return"translate("+(t.x+l-t.w)+","+(t.y-t.dy/2)+")";case"up":return"translate("+(t.x-t.dx/2)+","+t.y+")";case"down":return"translate("+(t.x-t.dx/2)+","+t.y+")"}}var l;l="left"===f.direction||"right"===f.direction?t.max(e,o):t.max(e,r);var d=new n.Renderer({nodeHeight:l,layerGap:f.layerGap,direction:f.direction});d.layout(e);var c=t.functor(f.labelBgColor),s=t.functor(f.linkColor),g=b.get("main.label").selectAll("g.label-g").data(e,f.keyFn?function(t){return f.keyFn(t.data)}:void 0),y=g.enter().append("g").classed("label-g",!0).on("click",function(t,e){m.labelClick(t.data,e)}).on("mouseover",function(t,e){m.labelMouseover(t.data,e)}).on("mousemove",function(t,e){m.labelMousemove(t.data,e)}).on("mouseenter",function(t,e){m.labelMouseenter(t.data,e)}).on("mouseleave",function(t,e){m.labelMouseleave(t.data,e)}).on("mouseout",function(t,e){m.labelMouseout(t.data,e)}).attr("transform",i);y.append("rect").classed("label-bg",!0).attr("rx",2).attr("ry",2).attr("width",o).attr("height",r).style("fill",function(t){return c(t.data)}),y.append("text").classed("label-text",!0).call(u,a,function(t){return t.data});var h=g.transition().attr("transform",i);h.select("rect").attr("width",o).attr("height",r).style("fill",function(t){return c(t.data)}),h.select("text.label-text").call(u,a,function(t){return t.data}),g.exit().remove();var p=b.get("main.link").selectAll("path.link").data(e,f.keyFn?function(t){return f.keyFn(t.data)}:void 0);p.enter().append("path").classed("link",!0).attr("d",function(t){return d.generatePath(t)}).style("stroke",function(t){return s(t.data)}).style("fill","none"),p.transition().style("stroke",function(t){return s(t.data)}).attr("d",function(t){return d.generatePath(t)}),p.exit().remove()}function u(e,n,a){return a=a?t.functor(a):function(t){return t},e.text(function(t){return f.textFn(a(t))}).attr("dy",f.textYOffset).attr("x",f.labelPadding.left).attr("y",f.labelPadding.top),Object.keys(n).forEach(function(t){var o=n[t];e.style(t,function(t,e){return o(a(t),e)})}),e}function s(){var e;switch(f.direction){case"up":e=t.max(g.nodes(),function(t){return Math.abs(t.y)})||0,a.height(e+f.margin.top+f.margin.bottom);break;case"down":e=t.max(g.nodes(),function(t){return Math.abs(t.y+t.dy)})||0,a.height(e+f.margin.top+f.margin.bottom);break;case"left":e=t.max(g.nodes(),function(t){return Math.abs(t.x)})||0,a.width(e+f.margin.left+f.margin.right);break;case"right":e=t.max(g.nodes(),function(t){return Math.abs(t.x+t.dx)})||0,a.width(e+f.margin.left+f.margin.right)}return a}var f=a.options(),m=a.getDispatcher(),b=a.getLayerOrganizer();b.create(["dummy",{main:["axis","link","label","dot"]}]);var g=new n.Force(f.labella),y=t.svg.axis();return m.on("resize",l),m.on("options",l),m.on("data",l),b.get("main.axis").classed("axis",!0),a.mixin({axis:y,visualize:l,resizeToFit:s})})})});